# üåæ –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è —Å–µ—Ä—ã –≤ –ø–æ—á–≤–∞—Ö –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞ ‚Äî –§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

## üìä –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**–ó–∞–¥–∞—á–∞:** –ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–µ—Ä—ã (S, mg/kg) –≤ –ø–æ—á–≤–∞—Ö —Å–µ–ª—å—Ö–æ–∑—É–≥–æ–¥–∏–π –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- –°–Ω–∏–º–∫–æ–≤ Sentinel-2 (–≤–µ—Å–Ω–∞, –ª–µ—Ç–æ, –æ—Å–µ–Ω—å)
- –¶–∏—Ñ—Ä–æ–≤–æ–π –º–æ–¥–µ–ª–∏ —Ä–µ–ª—å–µ—Ñ–∞ (DEM)
- –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

**–¶–µ–ª–µ–≤–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å:** R¬≤ ‚â• 0.5 (–¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏)

---

## ‚úÖ –¢–ï–°–¢–´ –ù–ê –£–¢–ï–ß–ö–ò –î–ê–ù–ù–´–•

| –¢–µ—Å—Ç | –†–µ–∑—É–ª—å—Ç–∞—Ç | –°—Ç–∞—Ç—É—Å |
|------|-----------|--------|
| **Permutation test (Ridge)** | R¬≤(shuffled) = -6.75 | ‚úÖ –ù–µ—Ç —É—Ç–µ—á–∫–∏ |
| **Permutation test (XGBoost)** | R¬≤(shuffled) = -0.045 ‚âà 0 | ‚úÖ –ù–µ—Ç —É—Ç–µ—á–∫–∏ |
| **Spatial proximity (Spearman)** | œÅ = +0.07, p = 0.544 | ‚úÖ –ù–µ—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —É—Ç–µ—á–∫–∏ |
| **Feature temporal audit** | 0 summer/autumn features | ‚úÖ –í—Å–µ 90 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —á–∏—Å—Ç—ã–µ |
| **Farm-level LOFO (—Å—Ç—Ä–æ–∂–µ)** | R¬≤=0.549 vs field-LOFO 0.679 | ‚ö†Ô∏è –°–ª–∞–±–∞—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∏–Ω—Ñ–ª—è—Ü–∏—è |
| **ICC –∞–Ω–∞–ª–∏–∑** | 22.6% –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –º–µ–∂–¥—É –ø–æ–ª—è–º–∏, 81.1% –º–µ–∂–¥—É —Ñ–µ—Ä–º–∞–º–∏ | ‚ö†Ô∏è –ú–µ–∂—Ñ–µ—Ä–º–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| **Residual autocorrelation** | r=+0.653, p<0.0001 | ‚ö†Ô∏è –û—Å—Ç–∞—Ç–∫–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω—ã |
| **climate_MAP/MAT proxy** | no_MAP_MAT R¬≤=0.679 (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) | ‚úÖ MAP/MAT –Ω–µ proxy-—É—Ç–µ—á–∫–∞ |

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Ö–æ–¥–∫–∞:** –í—ã—è–≤–ª–µ–Ω—ã –∏ –∏—Å–∫–ª—é—á–µ–Ω—ã 32 —Å–∫—Ä—ã—Ç—ã–µ delta-—Ñ–∏—á–∏ (`delta_*_spring_to_summer/autumn`), —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é —É—Ç–µ—á–∫—É. **Finalized feature set: 90 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**
- 78 spring-—Å–µ–∑–æ–Ω–Ω—ã—Ö (—Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã–µ, S2, L8, –∏–Ω–¥–µ–∫—Å—ã)
- 8 —Ç–æ–ø–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö (DEM, TPI, TWI, slope, aspect, curvatures)
- 4 –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö (MAT, MAP, GS_temp, GS_precip)

### Deep Leakage Audit (farm-level LOFO, 20 —Ñ–æ–ª–¥–æ–≤)

| Feature Set | Field-LOFO R¬≤ | Farm-LOFO R¬≤ | –†–∞–∑–Ω–∏—Ü–∞ |
|------------|---------------|--------------|---------|
| all90 (baseline) | 0.679 | 0.549 | -0.130 |
| spring_only (78) | 0.675 | 0.566 | -0.109 |
| topo+climate (12) | 0.669 | ‚Äî | ‚Äî |
| topo_only (8) | 0.537 | ‚Äî | ‚Äî |
| climate_only (4) | 0.526 | ‚Äî | ‚Äî |
| no_MAP_MAT (88) | 0.679 | 0.536 | -0.143 |

**–í—ã–≤–æ–¥ –∞—É–¥–∏—Ç–∞:** –£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö –°–õ–ê–ë–ê–Ø. –ú–æ–¥–µ–ª—å –æ–±–æ–±—â–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–µ —Ñ–µ—Ä–º—ã (R¬≤=0.549).
–ò–Ω—Ñ–ª—è—Ü–∏—è field‚Üífarm LOFO: +0.130 ‚Äî –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π (r=+0.653),
–Ω–æ –Ω–µ –ø—Ä—è–º–æ–π —É—Ç–µ—á–∫–æ–π –ø—Ä–∏–∑–Ω–∞–∫–æ–≤. –ß–µ—Å—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–µ—Ä–º: **R¬≤=0.549**.

---

## üèÜ –°–†–ê–í–ù–ï–ù–ò–ï –ú–û–î–ï–õ–ï–ô (LOFO-CV, 81 –ø–æ–ª–µ)

### –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ú–æ–¥–µ–ª—å | œÅ | R¬≤ | RMSE | MAE | –°—Ç–∞—Ç—É—Å |
|--------|-------|--------|---------|---------|---------|
| **Hybrid CNN+XGBoost (NEW)** | **+0.408** | **0.694** | **4.21** | **2.69** | ‚úÖ‚úÖ –õ–£–ß–®–ò–ô R¬≤ |
| XGBoost | +0.462 | 0.682 | 4.29 | 2.62 | ‚úÖ‚úÖ R¬≤>0.65 |
| CatBoost | +0.439 | 0.654 | 4.48 | 2.69 | ‚úÖ R¬≤>0.5 |
| Stacking (Ridge meta) | +0.435 | 0.674 | 4.35 | 2.70 | ‚úÖ R¬≤>0.5 |
| Ensemble (XGB+CNN) | +0.422 | 0.587 | 4.89 | 2.89 | ‚úÖ R¬≤>0.5 |
| ElasticNet | +0.297 | 0.465 | 5.57 | 3.37 | ‚ö†Ô∏è R¬≤<0.5 |
| CNN ResNet | +0.337 | 0.413 | 5.87 | 3.30 | ‚ùå R¬≤<0.5 |
| RF spring-clean | +0.366 | 0.399 | ‚Äî | ‚Äî | ‚ùå R¬≤<0.5 |

### –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è

1. **Hybrid CNN+XGBoost R¬≤=0.694** ‚Äî –Ω–æ–≤—ã–π –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   - ŒîR¬≤=+0.012 –Ω–∞–¥ XGBoost (CNN –¥–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä–æ—Å—Å-–∫–∞–Ω–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)
   - RPD=1.81 (–≥—Ä—É–±—ã–µ –æ—Ü–µ–Ω–∫–∏), CCC=0.806
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç 36-–∫–∞–Ω–∞–ª—å–Ω—ã–µ –ø—Å–µ–≤–¥–æ-–ø–∞—Ç—á–∏ (32√ó32) + 90 —Ç–∞–±–ª–∏—á–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

2. **XGBoost R¬≤=0.682** –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ü–µ–ª–µ–≤–æ–π R¬≤‚â•0.5 –Ω–∞ **36%**
   - –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å RF: +0.283 (71% —É–ª—É—á—à–µ–Ω–∏–µ!)
   - –ß–µ—Å—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–µ—Ä–º (farm-LOFO): R¬≤=0.549

3. **CNN standalone –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ** (R¬≤=0.413 vs XGBoost 0.682)
   - –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ 32√ó32 –ø–∞—Ç—á–∞—Ö –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞
   - –ù–æ –≤ Hybrid CNN –¥–æ–±–∞–≤–ª—è–µ—Ç +1.8% R¬≤

4. **Top-3 –ø—Ä–∏–∑–Ω–∞–∫–∞ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏:**
   ```
   spectral_B2_spring      0.399  ‚Üê —Å–∏–Ω–∏–π –∫–∞–Ω–∞–ª 490nm (–î–û–ú–ò–ù–ò–†–£–ï–¢!)
   s2_B2_spring           0.235  ‚Üê —Å–∏–Ω–∏–π –∫–∞–Ω–∞–ª S2
   topo_DEM               0.029  ‚Üê —Ü–∏—Ñ—Ä–æ–≤–∞—è –º–æ–¥–µ–ª—å —Ä–µ–ª—å–µ—Ñ–∞
   ```
   ‚Üí –°–µ—Ä–∞ —Å–∏–ª—å–Ω–æ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å —Å–∏–Ω–∏–º —Å–ø–µ–∫—Ç—Ä–æ–º (–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–µ –≤–µ—â–µ—Å—Ç–≤–æ?)

5. **Stacking –Ω–µ —É–ª—É—á—à–∞–µ—Ç XGBoost** (R¬≤=0.674 < 0.682)
   - –ë–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω—ã
   - Meta-learner –¥–æ–±–∞–≤–ª—è–µ—Ç —à—É–º –≤–º–µ—Å—Ç–æ —É–ª—É—á—à–µ–Ω–∏—è

---

## üîß –ù–û–í–´–ï –ú–ï–¢–†–ò–ö–ò –î–õ–Ø –ê–ì–†–ê–†–ò–ï–í

### XGBoost (–ª—É—á—à–∞—è –º–æ–¥–µ–ª—å) ‚Äî Agronomic Metrics

#### 1. –¢–æ—á–Ω–æ—Å—Ç—å —Ä–µ–≥—Ä–µ—Å—Å–∏–∏
```
R¬≤ = 0.682         (–æ–±—ä—è—Å–Ω—è–µ—Ç 68% –≤–∞—Ä–∏–∞—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è S)
RMSE = 4.29 mg/kg  (—Å—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞)
MAE = 2.62 mg/kg   (–∞–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞)
```

#### 2. –ü—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ (RPD / RPIQ)
```
RPD = 1.77         ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –¥–ª—è –≥—Ä—É–±—ã—Ö –æ—Ü–µ–Ω–æ–∫
RPIQ = 0.90        (—É—Å—Ç–æ–π—á–∏–≤ –∫ –≤—ã–±—Ä–æ—Å–∞–º)

–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è RPD:
  RPD < 1.4:     –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω–∞
  RPD 1.4-1.8:   –≥—Ä—É–±—ã–µ –æ—Ü–µ–Ω–∫–∏        ‚Üê –ó–î–ï–°–¨ (–º–æ–¥–µ–ª—å)
  RPD 1.8-2.5:   —Ç–æ—á–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏
  RPD > 2.5:     –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω—ã–µ
```

#### 3. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–∞ (Lin's CCC)
```
CCC = 0.803        ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ–µ —Å–æ–≥–ª–∞—Å–∏–µ

–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è CCC:
  CCC > 0.99:     –æ—Ç–ª–∏—á–Ω–æ–µ
  CCC 0.95-0.99:  –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–µ–µ
  CCC 0.90-0.95:  —Ö–æ—Ä–æ—à–µ–µ
  CCC 0.80-0.90:  —Å—Ä–µ–¥–Ω–µ–µ              ‚Üê –ó–î–ï–°–¨ (–º–æ–¥–µ–ª—å)
  CCC < 0.80:     —Å–ª–∞–±–æ–µ
```

#### 4. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–µ—Ñ–∏—Ü–∏—Ç–∞ —Å–µ—Ä—ã
```
–ê–≥—Ä–æ-—Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã (mg/kg):
  < 6      ‚Äî –î–ï–§–ò–¶–ò–¢ (–Ω—É–∂–Ω—ã —É–¥–æ–±—Ä–µ–Ω–∏—è)
  6-12     ‚Äî –°–†–ï–î–ù–ï–ï (–Ω–æ—Ä–º–∞)
  > 12     ‚Äî –í–´–°–û–ö–û–ï (–ø–µ—Ä–µ–∏–∑–±—ã—Ç–æ–∫)

XGBoost –Ω–∞ –¥–µ—Ñ–∏—Ü–∏—Ç:
  Recall = 32.5%      (–Ω–∞—Ö–æ–¥–∏—Ç 32% —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ—Ñ–∏—Ü–∏—Ç–æ–≤)
  Precision = 66.0%   (66% –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –æ –¥–µ—Ñ–∏—Ü–∏—Ç–µ –≤–µ—Ä–Ω—ã)
  F1 = 0.436
```

### üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ –¥–ª—è —Ñ–µ—Ä–º–µ—Ä–∞

‚ö†Ô∏è‚ö†Ô∏è **–ú–æ–¥–µ–ª—å –∏–º–µ–µ—Ç –û–ì–†–ê–ù–ò–ß–ï–ù–ù–£–Æ –ü–û–õ–ï–ó–ù–û–°–¢–¨ –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–µ—Ñ–∏—Ü–∏—Ç–∞**

- **Recall = 32%** –æ–∑–Ω–∞—á–∞–µ—Ç: –ø—Ä–æ–ø—É—Å—Ç–∏—Ç 2 –∏–∑ 3 –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–ª–µ–π
- **Precision = 66%** –æ–∑–Ω–∞—á–∞–µ—Ç: –∫–∞–∂–¥–∞—è 3-—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –æ–± —É–¥–æ–±—Ä–µ–Ω–∏–∏ –±—É–¥–µ—Ç –æ—à–∏–±–æ—á–Ω–æ–π
- –î–ª—è –Ω–∞–¥—ë–∂–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ—à–µ–Ω–∏–π –Ω—É–∂–µ–Ω **Recall ‚â• 70%**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å XGBoost –¥–ª—è **–æ–±—â–µ–π –æ—Ü–µ–Ω–∫–∏** —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è S
- ‚ö†Ô∏è –î–ª—è –¥–µ—Ñ–∏—Ü–∏—Ç-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç—å **–ø–æ–ª–µ–≤—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏**
- ‚ùå –ù–µ –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ —Ç–æ—á–Ω—ã–π –ø–æ—Ä–æ–≥ 6 mg/kg

---

## üìÇ –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã

### ML/results/leakage_and_models/
```
‚îú‚îÄ‚îÄ full_comparison.csv                  # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ xgboost_feature_importance.csv       # –í–∞–∂–Ω–æ—Å—Ç—å 90 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
‚îú‚îÄ‚îÄ xgboost_feature_importance_top25.png # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è top-25
‚îú‚îÄ‚îÄ scatter_oof_xgboost.png              # –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å (R¬≤=0.682)
‚îú‚îÄ‚îÄ scatter_oof_catboost.png             # CatBoost (R¬≤=0.654)
‚îú‚îÄ‚îÄ scatter_oof_stacking.png             # Ensemble (R¬≤=0.674)
‚îú‚îÄ‚îÄ permutation_test.png                 # –¢–µ—Å—Ç—ã –Ω–∞ —É—Ç–µ—á–∫—É
‚îî‚îÄ‚îÄ spatial_proximity_vs_r2.png          # –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
```

### ML/results/final_ensemble/
```
‚îú‚îÄ‚îÄ final_comparison_with_metrics.csv    # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å agronomic metrics
‚îú‚îÄ‚îÄ scatter_xgboost.png                  # XGBoost (–ª—É—á—à–∏–π)
‚îú‚îÄ‚îÄ scatter_ensemble.png                 # Ensemble —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚îî‚îÄ‚îÄ confusion_matrix_xgboost.png         # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞
```

---

## üöÄ –ö–û–î –ò –°–ö–†–ò–ü–¢–´

### Leakage & Alternative Models
```bash
.venv/bin/python ML/leakage_and_models.py
```
- Permutation tests (Ridge, XGBoost)
- –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- Ridge, ElasticNet, XGBoost, CatBoost, MLP, Stacking

### Agronomic Metrics
```python
from agronomic_metrics import compute_all_agronomic_metrics
metrics = compute_all_agronomic_metrics(y_true, y_pred)
# –í—ã—á–∏—Å–ª—è–µ—Ç: RPD, RPIQ, CCC, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```

### –£–ª—É—á—à–µ–Ω–Ω–∞—è CNN (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
```bash
.venv/bin/python ML/improve_cnn_sulfur.py
```
- Ensemble –∏–∑ 3 ResNet –º–æ–¥–µ–ª–µ–π
- LOFO-CV –ø–æ 81 –ø–æ–ª—é
- MAX_EPOCHS=250, BASE_CH=48, LR=1e-4

---

## üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –í—Å–µ–≥–æ –æ–±—Ä–∞–∑—Ü–æ–≤ | 1085 |
| –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π | 81 |
| –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ñ–µ—Ä–º | 20 |
| –ß–∏—Å—Ç—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ | 90 |
| –õ—É—á—à–∏–π R¬≤ | 0.682 (XGBoost) |
| –£–ª—É—á—à–µ–Ω–∏–µ vs RF | +71% |
| –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è | ~5 –º–∏–Ω (LOFO 81 fold) |

---

## üìù –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø

**–î–ª—è –Ω–∞—É—á–Ω–æ–π —Å—Ç–∞—Ç—å–∏ –≤–∫–ª—é—á–∏—Ç—å:**

1. **–¢–∞–±–ª–∏—Ü–∞ 1:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π (R¬≤, RMSE, œÅ)
2. **–¢–∞–±–ª–∏—Ü–∞ 2:** Agronomic metrics (RPD, CCC, Recall, Precision)
3. **–†–∏—Å—É–Ω–æ–∫ 1:** Scatter plot XGBoost (R¬≤=0.682)
4. **–†–∏—Å—É–Ω–æ–∫ 2:** Feature importance top-25
5. **–†–∏—Å—É–Ω–æ–∫ 3:** Confusion matrix –¥–ª—è –¥–µ—Ñ–∏—Ü–∏—Ç–∞

**–í—ã–≤–æ–¥—ã:**
- –î–æ—Å—Ç–∏–≥–Ω—É—Ç —Ü–µ–ª–µ–≤–æ–π R¬≤‚â•0.5 (0.682 –¥–ª—è XGBoost)
- –°–µ—Ä–∞ —Å–∏–ª—å–Ω–æ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å —Å–∏–Ω–∏–º —Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã–º –∫–∞–Ω–∞–ª–æ–º (~40% –≤–∞–∂–Ω–æ—Å—Ç–∏)
- –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ —Å–Ω–∏–º–∫–∞—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–µ—Ñ–∏—Ü–∏—Ç–∞
- –î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ—à–µ–Ω–∏–π –æ–± —É–¥–æ–±—Ä–µ–Ω–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–≤—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏

---

## üî¨ –ú–ï–¢–û–î–û–õ–û–ì–ò–Ø

- **Cross-Validation:** Leave-One-Field-Out (81 folds)
- **Per-fold normalization:** –ò—Å–∫–ª—é—á–∞–µ—Ç data leakage
- **Log1p transform:** –î–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è S
- **Metrics in original scale:** –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã –≤ mg/kg
- **Early stopping:** –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π val split (15% –æ—Ç train)
- **Feature engineering:** –ò—Å–∫–ª—é—á–µ–Ω—ã 32 –≤—Ä–µ–º–µ–Ω–Ω–æ-–ø—Ä–æ—Ç–µ–∫–∞—é—â–∏–µ delta-—Ñ–∏—á–∏

---

**–î–∞—Ç–∞:** 25 —Ñ–µ–≤—Ä–∞–ª—è 2026
**–ê–≤—Ç–æ—Ä:** Claude AI
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

